safe val := 0
atomic msg := ""

fun change_mem(n)
    atomic s := 0
    while true
       val = n
       s = val
       if ((s != 10) and (s != 11)) or (msg != "")
          msg = "bad value of val: %d" % s
          return s
       end
    end
end

fun join(th)
    while true
       if is_alive(th) == false
          return 0
       end
    end
end

fun main()
    const th := spawn(change_mem,10)
    change_mem(11)
    join(th)
    print("msg:",msg)
end
